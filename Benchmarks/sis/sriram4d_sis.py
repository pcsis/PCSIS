from pcsis.model import *
from pcsis.sis_problem import SISProblem
from pcsis.interval import Interval
from pcsis.ellipsoid import Ellipsoid

if __name__ == '__main__':
    model = Sriram4DSIS
    prob = SISProblem(model)

    alpha, beta = 0.005, 1e-20
    prob.set_options(degree_poly=6, lamda=0.99, alpha=alpha, beta=beta, C=-1,
                     U_al=1e3, random_seed=0, plot_project_values=[{2: 0, 3: 0}])

    # safe_set = Interval([-2] * 4, [2] * 4)
    safe_set = Ellipsoid([0.5] * 4, [1 / 4] * 4)

    x_safe, fx_safe, x_unsafe, fx_unsafe = prob.generate_data(safe_set)
    prob.set_obj(N1=1000)

    h1 = prob.solve(x_safe, fx_safe, x_unsafe, fx_unsafe)

    prob.get_probability(1e6)

    N2 = 1e6
    sim_data = prob.monte_carlo(N2, 3e2)
    print(r'P_x [x \in S] = ', len(sim_data) / N2, ', estimated by Monte Carlo method')

    prob.plot(h1)

    # sim_data_proj = prob.monte_carlo(N2, 3e2, proj_dim=[0, 1])
    # sim_data_proj = np.array([sim_data_proj[:, 0], sim_data_proj[:, 1]]).T
    # prob.plot(h1, sim_data=sim_data_proj)

    # h2 = '1000.00000004+999.999998157*x0+999.999999766*x1+999.999999788*x2+999.99999989*x3+999.99999798*x1^3+999.999999254*x2*x3+540.925002647*x0*x3-200.57714887*x0*x2+999.999998924*x3^3+999.999997864*x0^2+999.999999121*x1^2+999.999998976*x2^2+999.999999499*x3^2+622.36167088*x0*x1+999.99999878*x1*x2+999.999999282*x1*x3-983.706911912*x0^3+999.999988834*x0^2*x1-132.785701875*x0*x1^2+999.999989102*x0^2*x2-999.999907471*x0*x1*x2+999.999996276*x1^2*x2-999.999921495*x0*x2^2+999.999995494*x1*x2^2+999.99999674*x2^3+999.999994946*x0^2*x3+445.044847526*x0*x1*x3+999.999997964*x1^2*x3-999.999909051*x0*x2*x3+999.999996539*x1*x2*x3+999.999997473*x2^2*x3-999.999543011*x0*x3^2+999.999998062*x1*x3^2+999.999998026*x2*x3^2-484.987170885*x0^4-999.999928125*x0^3*x1-91.1019235237*x0^2*x1^2-999.999939088*x0*x1^3+999.9999822*x1^4-999.999397914*x0^3*x2+999.999909836*x0^2*x1*x2-999.99990972*x0*x1^2*x2+999.999985869*x1^3*x2-921.927766948*x0^2*x2^2-999.999877066*x0*x1*x2^2+197.512934871*x1^2*x2^2-999.999897593*x0*x2^3+999.999983909*x1*x2^3+809.476184626*x2^4-999.999896431*x0^3*x3+999.999979682*x0^2*x1*x3-999.999909134*x0*x1^2*x3+999.999994966*x1^3*x3+999.999971103*x0^2*x2*x3-999.999843346*x0*x1*x2*x3+999.999987456*x1^2*x2*x3-999.999846294*x0*x2^2*x3+999.999990828*x1*x2^2*x3+999.999990055*x2^3*x3+999.999726149*x0^2*x3^2-999.999916764*x0*x1*x3^2+999.99997808*x1^2*x3^2-999.999920829*x0*x2*x3^2+999.999991857*x1*x2*x3^2+999.999967854*x2^2*x3^2-999.999932742*x0*x3^3+999.999995656*x1*x3^3+999.999992675*x2*x3^3+999.999984605*x3^4+941.44644835*x0^5+20.2859426927*x0^4*x1+277.833638079*x0^3*x1^2-309.059675164*x0^2*x1^3-788.402645109*x0*x1^4+6.42732015024*x1^5+929.966819154*x0^4*x2-24.8010636579*x0^3*x1*x2-479.910452229*x0^2*x1^2*x2+89.2951292358*x0*x1^3*x2-13.1592483598*x1^4*x2+999.999945886*x0^3*x2^2+310.433878848*x0^2*x1*x2^2+999.999721517*x0*x1^2*x2^2-766.595733057*x1^3*x2^2+319.787281021*x0^2*x2^3+529.110426204*x0*x1*x2^3-351.42955829*x1^2*x2^3+958.863746251*x0*x2^4+356.783972071*x1*x2^4-580.569952239*x2^5+830.347120779*x0^4*x3-723.74249398*x0^3*x1*x3+352.380600524*x0^2*x1^2*x3-632.115047125*x0*x1^3*x3+641.307419643*x1^4*x3+113.995383845*x0^3*x2*x3+999.999787007*x0^2*x1*x2*x3+218.579523893*x0*x1^2*x2*x3-349.198119778*x1^3*x2*x3+999.999911154*x0^2*x2^2*x3+466.033864819*x0*x1*x2^2*x3-86.6477017192*x1^2*x2^2*x3+827.479562636*x0*x2^3*x3+999.999889515*x1*x2^3*x3+448.960986651*x2^4*x3+38.4897414884*x0^3*x3^2-45.9235868949*x0^2*x1*x3^2+999.999737859*x0*x1^2*x3^2-607.212198268*x1^3*x3^2-380.246453966*x0^2*x2*x3^2-648.667599691*x0*x1*x2*x3^2+284.645424667*x1^2*x2*x3^2-261.177380623*x0*x2^2*x3^2+660.211119892*x1*x2^2*x3^2+726.374676564*x2^3*x3^2-754.901848072*x0^2*x3^3-999.999762643*x0*x1*x3^3-415.086577119*x1^2*x3^3-516.174094694*x0*x2*x3^3+414.488577198*x1*x2*x3^3-99.0104101887*x2^2*x3^3+443.450895139*x0*x3^4+651.10846635*x1*x3^4-296.459499125*x2*x3^4-89.8256110028*x3^5-499.842477742*x0^6+207.276035521*x0^5*x1-563.584242212*x0^4*x1^2+882.425540585*x0^3*x1^3-999.999838196*x0^2*x1^4+783.191835527*x0*x1^5-999.9999487*x1^6-25.8666377821*x0^5*x2-409.065039912*x0^4*x1*x2+999.999578105*x0^3*x1^2*x2-429.724932236*x0^2*x1^3*x2+999.999945467*x0*x1^4*x2-999.999747295*x1^5*x2-999.999914104*x0^4*x2^2+776.650565434*x0^3*x1*x2^2-999.999855425*x0^2*x1^2*x2^2+999.999944138*x0*x1^3*x2^2-999.999928284*x1^4*x2^2+685.622007811*x0^3*x2^3-930.585012167*x0^2*x1*x2^3+999.999898135*x0*x1^2*x2^3-999.996971124*x1^3*x2^3-999.999930479*x0^2*x2^4+273.910772275*x0*x1*x2^4-999.999929551*x1^2*x2^4+362.613961399*x0*x2^5+127.042009772*x1*x2^5-999.999923004*x2^6+117.554435159*x0^5*x3-34.6048866251*x0^4*x1*x3+845.2713314*x0^3*x1^2*x3-454.806247065*x0^2*x1^3*x3+999.999846184*x0*x1^4*x3-468.797735201*x1^5*x3-999.999902173*x0^4*x2*x3+315.079115714*x0^3*x1*x2*x3-691.981743342*x0^2*x1^2*x2*x3+999.99993125*x0*x1^3*x2*x3-999.999909737*x1^4*x2*x3+700.375690966*x0^3*x2^2*x3-905.054033534*x0^2*x1*x2^2*x3+999.999894736*x0*x1^2*x2^2*x3-971.637430052*x1^3*x2^2*x3-999.999467881*x0^2*x2^3*x3+357.970280407*x0*x1*x2^3*x3-999.999796688*x1^2*x2^3*x3+397.80491031*x0*x2^4*x3-666.914229326*x1*x2^4*x3+34.5827042666*x2^5*x3-999.999925202*x0^4*x3^2+877.66921469*x0^3*x1*x3^2-999.999924786*x0^2*x1^2*x3^2+267.797939061*x0*x1^3*x3^2-999.9999462*x1^4*x3^2+986.24653472*x0^3*x2*x3^2-861.658943477*x0^2*x1*x2*x3^2+939.739333142*x0*x1^2*x2*x3^2-999.999915952*x1^3*x2*x3^2-999.999912422*x0^2*x2^2*x3^2+999.999854421*x0*x1*x2^2*x3^2-999.999939303*x1^2*x2^2*x3^2+245.273419348*x0*x2^3*x3^2-999.999357039*x1*x2^3*x3^2-999.999939834*x2^4*x3^2+989.373828564*x0^3*x3^3-999.999597447*x0^2*x1*x3^3+999.999143421*x0*x1^2*x3^3-999.999936241*x1^3*x3^3-485.874429482*x0^2*x2*x3^3+999.999798133*x0*x1*x2*x3^3-999.999932523*x1^2*x2*x3^3+999.999865134*x0*x2^2*x3^3-698.602142307*x1*x2^2*x3^3-999.999922852*x2^3*x3^3-999.999942386*x0^2*x3^4+803.994382111*x0*x1*x3^4-999.999947753*x1^2*x3^4+917.765285014*x0*x2*x3^4-967.700762821*x1*x2*x3^4-999.999946015*x2^2*x3^4+298.540041451*x0*x3^5-580.882631481*x1*x3^5-999.99994112*x2*x3^5-999.99995136*x3^6'
    # prob.plot(h2)


